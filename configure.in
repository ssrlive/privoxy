dnl Process this file with autoconf to produce a configure script.
dnl 
dnl $Id: configure.in,v 1.2 2001/05/13 22:04:51 administrator Exp $
dnl 
dnl Written by and Copyright (C) 2001 the SourceForge
dnl IJBSWA team.  http://ijbswa.sourceforge.net
dnl
dnl Based on the Internet Junkbuster originally written
dnl by and Copyright (C) 1997 Anonymous Coders and 
dnl Junkbusters Corporation.  http://www.junkbusters.com
dnl
dnl This program is free software; you can redistribute it 
dnl and/or modify it under the terms of the GNU General
dnl Public License as published by the Free Software
dnl Foundation; either version 2 of the License, or (at
dnl your option) any later version.
dnl 
dnl This program is distributed in the hope that it will
dnl be useful, but WITHOUT ANY WARRANTY; without even the
dnl implied warranty of MERCHANTABILITY or FITNESS FOR A
dnl PARTICULAR PURPOSE.  See the GNU General Public
dnl License for more details.
dnl 
dnl The GNU General Public License should be included with
dnl this file.  If not, you can view it at
dnl http://www.gnu.org/copyleft/gpl.html
dnl or write to the Free Software Foundation, Inc., 59
dnl Temple Place - Suite 330, Boston, MA  02111-1307, USA.
dnl 
dnl $Log: configure.in,v $
dnl 
AC_INIT(jcc.c)
AC_CONFIG_HEADER(config.h)

VERSION_MAJOR=2
VERSION_MINOR=9
VERSION_POINT=3

AC_SUBST(VERSION_MAJOR)
AC_SUBST(VERSION_MINOR)
AC_SUBST(VERSION_POINT)

AC_DEFINE_UNQUOTED(VERSION_MAJOR,${VERSION_MAJOR})
AC_DEFINE_UNQUOTED(VERSION_MINOR,${VERSION_MINOR})
AC_DEFINE_UNQUOTED(VERSION_POINT,${VERSION_POINT})
AC_DEFINE_UNQUOTED(VERSION,"${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_POINT}")

dnl Checks for programs.
dnl AC_PROG_CXX
AC_PROG_CC
AC_PROG_CPP
dnl AC_PROG_INSTALL
dnl AC_PROG_LN_S
dnl AC_PROG_MAKE_SET
dnl RANLIB is for PCRE:
dnl AC_PROG_RANLIB

AC_MINGW32
AC_CYGWIN
AC_EXEEXT
AC_OBJEXT

dnl Checks for libraries.
dnl AC_CHECK_LIB(pcre, pcre_compile)
dnl AC_CHECK_LIB(pcreposix, regcomp, pcre)

dnl Checks for header files.
AC_HEADER_STDC
dnl AC_HEADER_SYS_WAIT
dnl AC_CHECK_HEADERS(fcntl.h limits.h malloc.h sys/time.h unistd.h)
dnl limits.h is for PCRE:
dnl AC_CHECK_HEADERS(limits.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_TYPE_SIZE_T

dnl Checks for library functions.
dnl AC_TYPE_SIGNAL
dnl AC_CHECK_FUNC(strstr)
dnl bcopy and memmove are for PCRE
AC_CHECK_FUNCS(strerror bcopy memmove)

dnl Build type

AC_ARG_ENABLE(mingw32,
[  --enable-mingw32        Use mingw32 for a Windows GUI],
[if test $enableval = yes; then
    WIN_ONLY=
    CYGWIN_FLAGS="-mwindows -mno-cygwin"
    echo "Using mingw32 (Win32 GUI)"
  else
    WIN_ONLY=#
    if test "$CYGWIN" = "yes"; then
      CYGWIN_FLAGS="-mno-win32"
      echo "Using Cygnus (Win32 command line)"
    else
      CYGWIN_FLAGS=
    fi
  fi],
[if test "$MINGW32" = "yes"; then
    WIN_ONLY=
    CYGWIN_FLAGS="-mwindows -mno-cygwin"
    echo "Using mingw32 (Win32 GUI)"
  else
    WIN_ONLY=#
    if test "$CYGWIN" = "yes"; then
      CYGWIN_FLAGS="-mno-win32"
      echo "Using Cygnus (Win32 command line)"
    else
      CYGWIN_FLAGS=
    fi
  fi])

AC_SUBST(WIN_ONLY)
AC_SUBST(CYGWIN_FLAGS)

SOLARIS_ONLY=#
AC_SUBST(SOLARIS_ONLY)

dnl Features

dnl Regex engine:

GNU_REGEX_ONLY=
PCRE_REGEX_ONLY=
NO_REGEX_ONLY=#

AC_ARG_ENABLE(regex,
[  --disable-regex         Don't allow regular expressions in the blockfile],
[if test $enableval = yes; then
  AC_DEFINE(REGEX)
else
  NO_REGEX_ONLY=
  GNU_REGEX_ONLY=#
  PCRE_REGEX_ONLY=#
fi],AC_DEFINE(REGEX))

AC_ARG_ENABLE(pcre-regex,
[  --disable-pcre-regex    Use old, slow GNU Regex instead of PCRE.],
[if test $enableval = yes; then
  AC_DEFINE(PCRE)
  GNU_REGEX_ONLY=#
else
  PCRE_REGEX_ONLY=#
fi],[AC_DEFINE(PCRE)
  GNU_REGEX_ONLY=#
])

AC_SUBST(GNU_REGEX_ONLY)
AC_SUBST(PCRE_REGEX_ONLY)
AC_SUBST(NO_REGEX_ONLY)


dnl Other features:

AC_ARG_ENABLE(toggle,
[  --disable-toggle        Don't support temporary disable],
[if test $enableval = yes; then
  AC_DEFINE(TOGGLE)
fi],AC_DEFINE(TOGGLE))

PCRS_ONLY=
AC_ARG_ENABLE(pcrs,
[  --disable-pcrs          Don't support arbitrary content modification],
[if test $enableval = yes; then
  AC_DEFINE(PCRS)
  AC_DEFINE(DENY_GZIP)
else
  PCRS_ONLY=#
fi],[AC_DEFINE(PCRS) AC_DEFINE(DENY_GZIP)])
AC_SUBST(PCRS_ONLY)

AC_ARG_ENABLE(force,
[  --disable-force         Don't allow blockfle to be bypassed],
[if test $enableval = yes; then
  AC_DEFINE(FORCE_LOAD)
fi],AC_DEFINE(FORCE_LOAD))

AC_ARG_ENABLE(killpopup,
[  --disable-killpopup     Never block popups],
[if test $enableval = yes; then
  AC_DEFINE(KILLPOPUPS)
fi],AC_DEFINE(KILLPOPUPS))

AC_ARG_ENABLE(stats,
[  --disable-stats         Don't keep statistics],
[if test $enableval = yes; then
  AC_DEFINE(STATISTICS)
fi],AC_DEFINE(STATISTICS))

AC_ARG_ENABLE(split-proxy-args,
[  --disable-split-proxy-args  One big show-proxy-args page, not one per file.],
[if test $enableval = yes; then
  AC_DEFINE(SPLIT_PROXY_ARGS)
fi],AC_DEFINE(SPLIT_PROXY_ARGS))

AC_ARG_ENABLE(webdav,
[  --disable-webdav        Don't support WebDAV.  This option stops MS Outlook
                          Express from accessing HotMail e-mail.],
[if test $enableval = yes; then
  AC_DEFINE(WEBDAV)
fi],
AC_DEFINE(WEBDAV))

AC_ARG_ENABLE(ie-images,
[  --disable-ie-images     Don't auto-detect whether a request from MS Internet
                          Explorer is for an image or HTML.],
[if test $enableval = yes; then
  AC_DEFINE(DETECT_MSIE_IMAGES)
fi],
AC_DEFINE(DETECT_MSIE_IMAGES))

AC_ARG_ENABLE(image-list,
[  --disable-image-list    Don't try to figure out whether a request is for an
                          image or HTML using the imagelist - assume HTML.],
[if test $enableval = yes; then
  AC_DEFINE(USE_IMAGE_LIST)
fi],
AC_DEFINE(USE_IMAGE_LIST))

AC_ARG_ENABLE(acl-files,
[  --disable-acl-files     Prevents the use of ACL files to control access to
                          the proxy by IP address.],
[if test $enableval = yes; then
  AC_DEFINE(ACL_FILES)
fi],
AC_DEFINE(ACL_FILES))

AC_ARG_ENABLE(trust-files,
[  --disable-trust-files   Prevents the use of trust files.],
[if test $enableval = yes; then
  AC_DEFINE(TRUST_FILES)
fi],
AC_DEFINE(TRUST_FILES))

AC_ARG_ENABLE(jar-files,
[  --disable-jar-files     Prevents the use of jar files to capture cookies.],
[if test $enableval = yes; then
  AC_DEFINE(JAR_FILES)
fi],
AC_DEFINE(JAR_FILES))

LIBRARY_PCRE_ONLY=#
STATIC_PCRE_ONLY=
AC_ARG_ENABLE(static-pcre,
[  --disable-static-pcre   Link dynamically with the pcre and pcreposix
                          libraries.  You must build the libraries seperately.],
[if test $enableval = no; then
  LIBRARY_PCRE_ONLY=
  STATIC_PCRE_ONLY=#
fi])
AC_SUBST(LIBRARY_PCRE_ONLY)
AC_SUBST(STATIC_PCRE_ONLY)

AC_OUTPUT(Makefile)

